Categories:
  - Sports & Health
License: EUPL-1.2
WebSite: https://www.jan-exner.de/software/android/jkbikemdp
SourceCode: https://codeberg.org/jexner/JKBikeMechanicalDisasterPrevention
IssueTracker: https://codeberg.org/jexner/JKBikeMechanicalDisasterPrevention/issues

AutoName: J-K Bike - Mechanical Disaster Prevention

RepoType: git
Repo: https://codeberg.org/jexner/JKBikeMechanicalDisasterPrevention.git
Binaries: https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_%v_%c.apk

Builds:
  - versionName: 1.1.1
    versionCode: 3
    commit: 22637f1c55699dea01631bd79e07d1c85a5a75c0
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    output: build/outputs/apk/release/*.apk
    srclibs:
      - reproducible-apk-tools@v0.3.0
    prebuild: gradle clean
    build:
      - mkdir upstream
      - pushd upstream
      - curl -L -o upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk
      - export upstreamhash=$(sha256sum assets/dexopt/baseline.prof|cut -d " " -f1)
      - popd
      - for i in {1..10}; do gradle clean assembleRelease; mkdir local; pushd local;
        unzip -q ../build/outputs/apk/release/*.apk; export localhash=$(sha256sum
        assets/dexopt/baseline.prof|cut -d " " -f1); [[ $localhash == $upstreamhash
        ]] && break ; popd; rm -fr local; done
    postbuild: $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines
      $$OUT$$ 'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'

  - versionName: 1.3.0
    versionCode: 5
    commit: 04ad45b3430fe103cbec8bef2ec06745c7f74eb8
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    output: build/outputs/apk/release/*.apk
    srclibs:
      - reproducible-apk-tools@v0.3.0
    prebuild: gradle clean
    build:
      - mkdir upstream
      - pushd upstream
      - curl -L -o upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk
      - export upstreamhash=$(sha256sum assets/dexopt/baseline.prof|cut -d " " -f1)
      - popd
      - for i in {1..10}; do gradle clean assembleRelease; mkdir local; pushd local;
        unzip -q ../build/outputs/apk/release/*.apk; export localhash=$(sha256sum
        assets/dexopt/baseline.prof|cut -d " " -f1); [[ $localhash == $upstreamhash
        ]] && break ; popd; rm -fr local; done
    postbuild: $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines
      $$OUT$$ 'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'

  - versionName: 1.4.0
    versionCode: 6
    commit: eb48647c49cd780835c96825daa707cf3886d838
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    output: build/outputs/apk/release/*.apk
    srclibs:
      - reproducible-apk-tools@v0.3.0
    prebuild: gradle clean
    build:
      - mkdir upstream
      - pushd upstream
      - curl -L -o upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk
      - export upstreamhash=$(sha256sum assets/dexopt/baseline.prof|cut -d " " -f1)
      - popd
      - for i in {1..10}; do gradle clean assembleRelease; mkdir local; pushd local;
        unzip -q ../build/outputs/apk/release/*.apk; export localhash=$(sha256sum
        assets/dexopt/baseline.prof|cut -d " " -f1); [[ $localhash == $upstreamhash
        ]] && break ; popd; rm -fr local; done
    postbuild: $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines
      $$OUT$$ 'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/*.json'

  - versionName: 2.1.1
    versionCode: 9
    commit: b6ab029be27c46be2280834324edbcaec17a1495
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'

  - versionName: 3.0.1
    versionCode: 11
    commit: 0e468416bcbdc949b045709d65659da94fcea459
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/3.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/6.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/7.json'

  - versionName: 3.1.1
    versionCode: 13
    commit: d5690c40fddb26503f9164233c561cce18e60456
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/3.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/6.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/7.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/8.json'

  - versionName: 3.1.2
    versionCode: 14
    commit: fea1bb4624448ca30134fcfe6c4af1865188f102
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/3.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/6.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/7.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/8.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/9.json'

  - versionName: 3.1.3
    versionCode: 15
    commit: a35e08c1d61eba63007509edd098bb788870621e
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/3.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/6.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/7.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/8.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/9.json'

  - versionName: 3.2.0
    versionCode: 16
    commit: 98dc98c631f4adf90f1b23171e8bb14e6690d23e
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/3.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/6.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/7.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/8.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/9.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/10.json'

  - versionName: 3.3.1
    versionCode: 18
    commit: 66ae2112118eb1fbb0a5a08f89085d0c9d9c756b
    subdir: app
    sudo:
      - export CPUS_MAX=6
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild:
      - curl -Lo upstream.apk https://www.jan-exner.de/software/android/jkbikemdp/JK-Bike_Mechanical_Disaster_Prevention_release_$$VERSION$$_$$VERCODE$$.apk
      - unzip -q upstream.apk -d apk
      - export hash=$(sha256sum apk/assets/dexopt/baseline.prof)
      - rm -rf apk upstream.apk
      - for i in {1..10}; do unzip -q $$OUT$$ -d apk; sha256sum -c - <<< $hash &&
        break; sha256sum apk/assets/dexopt/baseline.prof; rm -fr apk; gradle clean
        assembleRelease; done
      - $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines $$OUT$$
        'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/1.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/2.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/3.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/4.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/5.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/6.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/7.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/8.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/9.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/10.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/11.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/12.json'
        'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/13.json'

  - versionName: 3.4.0
    versionCode: 19
    commit: 4d3111c7253812f41f09a7d8492ee051265f27b3
    subdir: app
    sudo:
      - export CPUS_MAX=4
      - export CPUS=$(getconf _NPROCESSORS_ONLN)
      - for (( c=$CPUS_MAX; c<$CPUS; c++ )) ; do echo 0 > /sys/devices/system/cpu/cpu$c/online
        ; done
    gradle:
      - yes
    srclibs:
      - reproducible-apk-tools@v0.3.0
    postbuild: $$reproducible-apk-tools$$/inplace-fix.py --page-size 16 fix-newlines
      $$OUT$$ 'META-INF/services/*' 'assets/schemas/com.exner.tools.jkbikemechanicaldisasterprevention.database.KJsDatabase/*.json'

AllowedAPKSigningKeys: 07a89b9b74e8d980673671912166ace204c2f73523cd631b933cb4f77ac4a2cf

AutoUpdateMode: Version
UpdateCheckMode: Tags
CurrentVersion: 3.4.0
CurrentVersionCode: 19
